<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SnapScale - Creator Upload</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="app.css" rel="stylesheet">

  <style>
    body { background:#0e1224 !important; color:#ffffff !important; }
    h1,h2,h3,h4,h5,h6 { color:#ffffff !important; }
    p,label,span,div { color:#d1d6ff; }
    .card { background:#1a1f3a !important; border:1px solid #2a2f55 !important; }
    input.form-control, textarea.form-control { background:#ffffff !important; color:#000000 !important; }
    input::placeholder, textarea::placeholder { color:#666666 !important; }
  </style>
</head>
<body>

<nav class="navbar border-bottom border-secondary">
  <div class="container">
    <div class="d-flex align-items-center gap-2">
      <span style="width:10px;height:10px;border-radius:50%;background:linear-gradient(90deg,#4f7cff,#ff4fd8);display:inline-block;box-shadow:0 0 10px rgba(79,124,255,.8);"></span>
      <strong style="color:#ffffff;font-size:1.2rem;">SnapScale</strong>
    </div>

    <div class="d-flex align-items-center gap-2 ms-auto">
      <a class="btn btn-outline-light btn-sm" href="index.html">Back to Feed</a>
      <div id="navUser" class="ms-2"></div>
      <button class="btn btn-light btn-sm" onclick="logoutAndRedirect()">Logout</button>
    </div>
  </div>
</nav>

<div class="container py-5" style="max-width: 860px;">
  <div class="card p-4">
    <h1 class="h4 mb-2">Creator Upload</h1>
    <p class="mb-3">Only creator accounts can upload.</p>

    <div id="guard" class="text-danger mb-3"></div>

    <form id="form" class="d-none">
      <div class="mb-3">
        <label class="form-label">Image</label>
        <input class="form-control" type="file" name="image" accept="image/*" required>
      </div>

      <div class="row g-2">
        <div class="col-md-6">
          <label class="form-label">Title</label>
          <input class="form-control" name="title" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Location</label>
          <input class="form-control" name="location">
        </div>
      </div>

      <div class="mt-3">
        <label class="form-label">Caption</label>
        <textarea class="form-control" name="caption" rows="3"></textarea>
      </div>

      <div class="mt-3">
        <label class="form-label">People present</label>
        <input class="form-control" name="people" placeholder="Comma-separated (optional)">
      </div>

      <button class="btn btn-light mt-3" type="submit">Upload</button>
      <div id="msg" class="mt-2"></div>
    </form>
  </div>
</div>

<script src="app.js"></script>
<script>
if (!requireLoginOrRedirect()) {}
setNavUser();

(function guardRole(){
  const user = getUser();
  const guard = document.getElementById("guard");
  const form = document.getElementById("form");

  if (!user) {
    guard.textContent = "Login required.";
    return;
  }
  if (user.role !== "creator") {
    guard.textContent = "Access denied: this page is CREATOR-only.";
    return;
  }
  guard.textContent = "";
  form.classList.remove("d-none");
})();

document.getElementById("form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const msg = document.getElementById("msg");
  msg.className = "muted";
  msg.textContent = "Uploading...";

  const fd = new FormData(e.target);
  const res = await apiFetch("/api/media", { method:"POST", body: fd });
  if (res.status === 401) return logoutAndRedirect();

  const data = await res.json();
  if (!res.ok) {
    msg.className = "text-danger mt-2";
    msg.textContent = data.error || "Upload failed";
    return;
  }

  msg.className = "text-success mt-2";
  msg.textContent = "Uploaded âœ… Redirecting to feed...";
  setTimeout(() => window.location.href = "index.html", 600);
});
</script>
</body>
</html>
