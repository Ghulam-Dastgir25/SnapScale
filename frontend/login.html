<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SnapScale – Login</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="app.css" rel="stylesheet">

  <style>
    body { background:#0e1224 !important; color:#ffffff !important; }
    h1,h2,h3,h4,h5,h6 { color:#ffffff !important; }
    p,label,span,div { color:#d1d6ff; }
    .card { background:#1a1f3a !important; border:1px solid #2a2f55 !important; }
    input.form-control { background:#ffffff !important; color:#000000 !important; }
    input::placeholder { color:#666666 !important; }
  </style>
</head>
<body>

<nav class="navbar border-bottom border-secondary">
  <div class="container">
    <div class="d-flex align-items-center gap-2">
      <span style="width:10px;height:10px;border-radius:50%;background:linear-gradient(90deg,#4f7cff,#ff4fd8);display:inline-block;box-shadow:0 0 10px rgba(79,124,255,.8);"></span>
      <strong style="color:#ffffff;font-size:1.2rem;">SnapScale</strong>
    </div>
  </div>
</nav>

<div class="container py-5" style="max-width: 1000px;">
  <div class="row g-4">

    <div class="col-md-5">
      <div class="card p-4">
        <h2 class="mb-3">Login</h2>

        <input id="loginEmail" class="form-control mb-2" placeholder="Email">
        <input id="loginPass" type="password" class="form-control mb-3" placeholder="Password">

        <button class="btn btn-light w-100" type="button" onclick="login()" id="loginBtn">Login</button>
        <div id="loginMsg" class="text-danger mt-2"></div>

        <hr style="border-color:#2a2f55">
        <p><strong>Creator demo account</strong></p>
        <div>Email: <span style="color:#ffffff">creator@snayscale.com</span></div>
        <div>Password: <span style="color:#ffffff">Creator123!</span></div>
      </div>
    </div>

    <div class="col-md-7">
      <div class="card p-4">
        <h2 class="mb-3">Register (Consumer)</h2>
        <p class="muted2 mb-2">Password must be at least 8 chars and include uppercase, lowercase, and a number.</p>

        <input id="regEmail" class="form-control mb-2" placeholder="Email">
        <input id="regPass" type="password" class="form-control mb-3" placeholder="Password">

        <button class="btn btn-outline-light" type="button" onclick="register()" id="regBtn">Register</button>
        <div id="regMsg" class="mt-2"></div>
      </div>
    </div>

  </div>
</div>

<script>
const API = ""; // same-origin because frontend is served by backend
function el(id){ return document.getElementById(id); }

function isValidEmail(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email);
}
function isStrongPassword(pw){
  if (typeof pw !== "string") return false;
  if (pw.length < 8) return false;
  if (!/[A-Z]/.test(pw)) return false;
  if (!/[a-z]/.test(pw)) return false;
  if (!/[0-9]/.test(pw)) return false;
  return true;
}

async function register() {
  const email = el("regEmail").value.trim().toLowerCase();
  const password = el("regPass").value;
  const msg = el("regMsg");
  const btn = el("regBtn");

  msg.textContent = "";
  msg.className = "mt-2";

  // ✅ Frontend validation
  if (!isValidEmail(email)) {
    msg.className = "text-danger mt-2";
    msg.textContent = "Invalid email. Use: name@example.com";
    return;
  }
  if (!isStrongPassword(password)) {
    msg.className = "text-danger mt-2";
    msg.textContent = "Weak password. Min 8 + uppercase + lowercase + number.";
    return;
  }

  btn.disabled = true;
  msg.className = "muted mt-2";
  msg.textContent = "Registering...";

  const res = await fetch(API + "/api/auth/register", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await res.json().catch(()=>({}));
  if (!res.ok) {
    msg.className = "text-danger mt-2";
    msg.textContent = data.error || "Registration failed";
    btn.disabled = false;
    return;
  }

  msg.className = "text-success mt-2";
  msg.textContent = "Registered ✅ Now login.";

  // clear fields
  el("regEmail").value = "";
  el("regPass").value = "";
  btn.disabled = false;
}

async function login() {
  const email = el("loginEmail").value.trim().toLowerCase();
  const password = el("loginPass").value;
  const msg = el("loginMsg");
  const btn = el("loginBtn");

  msg.textContent = "";

  if (!isValidEmail(email)) {
    msg.textContent = "Enter a valid email.";
    return;
  }
  if (!password) {
    msg.textContent = "Password is required.";
    return;
  }

  btn.disabled = true;

  const res = await fetch(API + "/api/auth/login", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await res.json().catch(()=>({}));
  if (!res.ok) {
    msg.textContent = data.error || "Login failed";
    btn.disabled = false;
    return;
  }

  localStorage.setItem("token", data.token);
  localStorage.setItem("user", JSON.stringify(data.user));
  window.location.href = "index.html";
}

el("loginPass").addEventListener("keydown", (e)=>{ if(e.key==="Enter") login(); });
el("regPass").addEventListener("keydown", (e)=>{ if(e.key==="Enter") register(); });
</script>

</body>
</html>
